wbc = dat$WBC
mass = dat$AdultBodyMass_g
# Check that the order of the tree and data match
name.check(tree, dat)
# Great! Time for analysis!
wbcPic <- pic(wbc, tree, scaled=TRUE)
massPic <- pic(log(mass), tree, scaled=TRUE)
mean(massPic)
mean(wbcPic)
.1/1.05
.9/1.05
# Convert the covariance matrix to a correlation matrix
corrmat <- cov2cor(vcv(phy))
# Print the matrix, rounding the numbers to three decimals
round(corrmat,3)
corrmat <- vcv(phy,corr=TRUE)
round(corrmat,3)
corrmat <- vcv(phy,corr=TRUE)
round(corrmat,3)
vcv(phy)
#now we can do a PGLS using nlme
wbc.gls <- gls(WBC ~ log(AdultBodyMass_g), data=dat)
summary(wbc.gls)
plot(tree)
plot(tree , tip.color = NA)
?tiplabels
plot(tree , tip.color = NA)
tiplabels(pch = 20)
resids = resid(wbc.gls)
range(resids)
?plot.phylo
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (resids+6)/8 ,
col = ifelse(resids<0 , "orange" , "purple"))
display.brewer.all()
library(brms); library(RColorBrewer)
display.brewer.all()
tiplabels(pch = 20 , cex = (resids+6)/7 ,
col = ifelse(resids<0 , "orange" , "purple"))
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (resids+6)/7 ,
col = ifelse(resids<0 , "orange" , "purple"))
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (resids+6)/6 ,
col = ifelse(resids<0 , "orange" , "purple"))
display.brewer.all()
plot(tree , show.tip.label = F)
tiplabels(pch = 21 , cex = (resids+6)/6 ,
bg = ifelse(resids<0 , "orange" , "purple"))
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (resids+6)/6 ,
bg = ifelse(resids<0 , rgb(1,0,0,.5) , rgb(0,0,1,.5)))
tiplabels(pch = 20 , cex = (resids+6)/6 ,
col = ifelse(resids<0 , rgb(1,0,0,.5) , rgb(0,0,1,.5)))
col2rgb("orange")
col2rgb("orange")/255
col2rgb("purple")/255
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (resids+6)/6 ,
col = ifelse(resids<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
resids
?tiplabels
legend("topleft" , pch = 20 , legend = legendVals , cex = (legendVals+6)/6,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
legendVals = c(-5,-2.5,2.5,5)
legend("topleft" , pch = 20 , legend = legendVals , cex = (legendVals+6)/6,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
legend("topleft" , pch = 20 , legend = legendVals , cex.points = (legendVals+6)/6,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (resids+6)/6 ,
col = ifelse(resids<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
legendVals = c(-5,-2.5,2.5,5)
legend("topleft" , pch = 20 , legend = legendVals , pt.cex = (legendVals+6)/6,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (abs(resids))/3 ,
col = ifelse(resids<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
legendVals = c(-5,-2.5,2.5,5)
legend("topleft" , pch = 20 , legend = legendVals , pt.cex = (abs(legendVals)+6)/6,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
plot(tree , show.tip.label = F)
tiplabels(pch = 20 , cex = (abs(resids))/2 ,
col = ifelse(resids<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
legendVals = c(-5,-2.5,2.5,5)
legend("topleft" , pch = 20 , legend = legendVals , pt.cex = (abs(legendVals))/2,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)))
legend("topleft" , pch = 20 , legend = legendVals , pt.cex = (abs(legendVals))/2,
col = ifelse(legendVals<0 , rgb(1,.6,0,.5) , rgb(.6,.1,.9,.5)),
title = "residual")
setwd("~/Documents/tidy_tuesday")
library(tidyverse)
sw <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv",
header = F , stringsAsFactors = F)
#csv did not read with header b/c of question marks
#get questions and remove from dataset
questions <- as.character(sw[1,])
sw = sw[-c(1:2),]
#separate out multiple-choice questions
filmsSeen <- select(sw , c(1,4:9))
colnames(filmsSeen)[c(2:7)] <- apply(filmsSeen[,c(2:7)] , 2 , function(x) unique(x[x!=""]))
filmsSeen <- mutate_at(filmsSeen , c(2:7) , function(x) x!="")
filmsSeen = full_join(filmsSeen , select(sw , c(1,34:38)) , by = "V1")
colnames(filmsSeen)[c(8:12)] <- questions[c(34:38)]
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = group_by(filmsByAge , Age)
filmsByAge = summarize(filmsByAge , Movie)
plot <- geom_bar(aes(x = Age , y = Seen) , filmsByAge)
library(tidyverse)
sw <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv",
header = F , stringsAsFactors = F)
#csv did not read with header b/c of question marks
#get questions and remove from dataset
questions <- as.character(sw[1,])
sw = sw[-c(1:2),]
#separate out multiple-choice questions
filmsSeen <- select(sw , c(1,4:9))
colnames(filmsSeen)[c(2:7)] <- apply(filmsSeen[,c(2:7)] , 2 , function(x) unique(x[x!=""]))
filmsSeen <- mutate_at(filmsSeen , c(2:7) , function(x) x!="")
filmsSeen = full_join(filmsSeen , select(sw , c(1,34:38)) , by = "V1")
colnames(filmsSeen)[c(8:12)] <- questions[c(34:38)]
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = group_by(filmsByAge , Age)
?group_by
filmsByAge = group_by(filmsByAge , Movie , add = T)
filmsByAge = summarize(filmsByAge , function(x) length(which(x)))
?summarize
filmsByAge = summarize(filmsByAge , sum)
filmsByAge
filmsByAge = summarize(filmsByAge , Movie , sum)
filmsByAge = summarize(filmsByAge , Seen , sum)
filmsByAge = summarize(filmsByAge , total = sum)
?summarize_each
filmsByAge = summarize_all(filmsByAge , total = sum)
filmsByAge = summarize_all(filmsByAge , n = n()  , seen = sum())
filmsByAge = summarize_all(filmsByAge , n = n() )
filmsByAge = summarize_all(filmsByAge , mean)
filmsByAge
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = group_by(filmsByAge , Age)
filmsByAge = group_by(filmsByAge , Movie , add = T)
filmsByAge = summarize_at(filmsByAge , is.logical , sum)
filmsByAge = summarize_if(filmsByAge , is.logical , sum)
filmsByAge
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = group_by(filmsByAge , Age)
filmsByAge = group_by(filmsByAge , Movie , add = T)
filmsByAge = summarize_if(filmsByAge , is.logical , mean)
filmsByAge
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = group_by(filmsByAge , Age)
filmsByAge = group_by(filmsByAge , Movie , add = T)
filmsByAge2 = summarize_if(filmsByAge , is.logical , sum)
nrow(filmsByAge2)
nrow(filmsByAge)
unique(filmsByAge$Age)
unique(paste(filmsByAge$Age,filmsByAge$Movie))
seenByAge = summarize_if(filmsByAge , is.logical , sum)
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = group_by(filmsByAge , Age)
filmsByAge = group_by(filmsByAge , Movie , add = T)
seenByAge = summarize_if(filmsByAge , is.logical , sum)
nByAge = summarize_if(filmsByAge , is.logical , n())
nByAge = summarize_if(filmsByAge , is.logical , n
seenByAge = summarize_if(filmsByAge , is.logical , sum)
seenByAge = summarize_if(filmsByAge , is.logical , sum)
nByAge = summarize_if(filmsByAge , is.logical , count)
nByAge = summarize_all(filmsByAge , count)
seenByAge
seenByAge = summarize_if(filmsByAge , is.logical , c(sum , count))
seenByAge = summarize_if(filmsByAge , is.logical , c(sum , length))
seenByAge
jead(seenByAge)
head(seenByAge)
seenByAge = summarize_all(filmsByAge , is.logical , c(sum , length))
seenByAge = summarize_all(filmsByAge , c(sum , length))
seenByAge
seenByAge = summarize_all(filmsByAge , sum , length)
filmsByAge
filmsByAge %>%
summarise(mean = sum(Seen), n = n())
seenByAge = summarize(filmsByAge , seen = sum(Seen), n = n())
seenByAge
head(seenByAge)
head(seenByAge)
?mutate
seenByAge = mutate(seenByAge , prop = seen/n)
seenByAge
plot <- geom_bar(aes(x = Age , y = Seen) , seenByAge)
plot
?geon_bar
fitContinuous(dat$WBC,tree,"lambda")
??fitcontinuous
plot <- geom_bar(aes(x = Age , y = Seen) , data = seenByAge)
plot
plot <- geom_bar(aes(x = Age , y = Seen) , data = seenByAge,
width = Age)
plot <- geom_bar(aes(x = Age , y = Seen , width = 1) , data = seenByAge)
plot <- geom_bar(aes(x = Age , y = Seen) , data = filmsByAge)
plot
plot <- geom_bar(aes(x = Age , y = seen) , data = seenByAge)
plot
plot <- geom_bar(aes(x = Age , y = seen) , data = filmsByAge,
stat = "prop")
plot <- ggplot(aes(x = Age , y = seen) , data = filmsByAge) +
geom_bar()
plot
plot <- ggplot(aes(x = Age , y = Seen) , data = filmsByAge) +
geom_bar()
plot
plot <- ggplot(aes(x = Age) , data = filmsByAge) +
geom_bar()
plot
plot <- ggplot(aes(x = Age) , data = filmsByAge) +
geom_bar(aes(fill = Movie))
plot
filmsByAge = select(filmsByAge , Age != "")
filmsByAge
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = select(filmsByAge , Age != "")
names(filmsByAge)
?select
filmsByAge = filter(filmsByAge , Age != "")
filmsByAge = group_by(filmsByAge , Age)
filmsByAge = group_by(filmsByAge , Movie , add = T)
plot <- ggplot(aes(x = Age) , data = filmsByAge) +
geom_bar(aes(fill = Movie))
plot
?replace
?mutate
filmsByAge = mutate(filmsByAge , Age = replace(Age , "> 60" , "60+"))
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = filter(filmsByAge , Age != "")
filmsByAge = mutate(filmsByAge , Age = replace(Age , "> 60" , "60+"))
filmsByAge = gather(select(filmsSeen , c(2:7,9)) , Movie , Seen , 1:6)
filmsByAge = filter(filmsByAge , Age != "")
filmsByAge = mutate(filmsByAge , Age = replace(Age , "> 60" , "60+"))
?geom_bar
names(filmsSeen)
questions
#separate out multiple-choice questions
favorites <- select(sw , c(1,11,34:38))
favorites
head(favorites)
colnames(favorites) <- c("ID","favorite",questions[c(34:38)])
favorites <- filter(favorites , favorite != "")
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = favorite))
plot
favorites <- filter(favorites , favorite != "" & Age!="")
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = favorite))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
stat_count(aes(fill = favorite))
plot
questions
sw <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv",
header = F , stringsAsFactors = F)
sw[1,]
sw[2,]
movies = sw[2,4:9]
sw <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv",
header = F , stringsAsFactors = F)
#csv did not read with header b/c of question marks
#get questions and remove from dataset
questions <- as.character(sw[1,])
movies = sw[2,4:9]
sw = sw[-c(1:2),]
#separate out multiple-choice questions
filmsSeen <- select(sw , c(1,4:9))
colnames(filmsSeen)[c(2:7)] <- apply(filmsSeen[,c(2:7)] , 2 , function(x) unique(x[x!=""]))
filmsSeen <- mutate_at(filmsSeen , c(2:7) , function(x) x!="")
#separate out multiple-choice questions
favorites <- select(sw , c(1,11,34:38))
colnames(favorites) <- c("ID","favorite",questions[c(34:38)])
favorites <- filter(favorites , favorite != "" & Age!="")
favorites <- mutate(favorites , faveName = movies[favorites$favorite])
favorites$favorite
favorites <- mutate(favorites , favorite = as.numeric(favorite))
favorites <- mutate(favorites , faveName = movies[favorites$favorite])
favorites
#separate out multiple-choice questions: favorite movies
favorites <- select(sw , c(1,11,34:38))
colnames(favorites) <- c("ID","favorite",questions[c(34:38)])
favorites <- filter(favorites , favorite != "" & Age!="")
favorites <- mutate(favorites , favorite = as.numeric(favorite))
favorites <- mutate(favorites , faveName = movies[favorites$favorite])
favorites
#separate out multiple-choice questions: favorite movies
favorites <- select(sw , c(1,11,34:38))
colnames(favorites) <- c("ID","favorite",questions[c(34:38)])
favorites <- filter(favorites , favorite != "" & Age!="")
favorites <- mutate(favorites , favorite = as.numeric(favorite))
favorites
movies[favorites$favorite]
faveName = movies[favorites$favorite]
faveName
str(faveName)
movies
str(movies)
movies = as.character(sw[2,4:9])
movies
sw <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv",
header = F , stringsAsFactors = F)
#csv did not read with header b/c of question marks
#get questions and remove from dataset
questions <- as.character(sw[1,])
movies = as.character(sw[2,4:9])
movies
sw <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/star-wars-survey/StarWars.csv",
header = F , stringsAsFactors = F)
#csv did not read with header b/c of question marks
#get questions and remove from dataset
questions <- as.character(sw[1,])
movies = as.character(sw[2,4:9])
sw = sw[-c(1:2),]
#separate out multiple-choice questions: movies seen
filmsSeen <- select(sw , c(1,4:9))
colnames(filmsSeen)[c(2:7)] <- apply(filmsSeen[,c(2:7)] , 2 , function(x) unique(x[x!=""]))
filmsSeen <- mutate_at(filmsSeen , c(2:7) , function(x) x!="")
#separate out multiple-choice questions: favorite movies
favorites <- select(sw , c(1,11,34:38))
colnames(favorites) <- c("ID","favorite",questions[c(34:38)])
favorites <- filter(favorites , favorite != "" & Age!="")
favorites <- mutate(favorites , favorite = as.numeric(favorite))
favorites <- mutate(favorites , faveName = movies[favorites$favorite])
favorites
plot <- ggplot(aes(x = Age) , data = favorites) +
stat_count(aes(fill = favorite))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
stat_count(aes(fill = faveName))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_col(aes(fill = faveName))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName))
plot
plot <- ggplot(aes(x = Gender) , data = favorites) +
geom_bar(aes(fill = faveName))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill")
plot
favorites$Age = gsub(favorites$Age , "> 60" , "60+")
favorites <- select(sw , c(1,11,34:38))
colnames(favorites) <- c("ID","favorite",questions[c(34:38)])
favorites <- filter(favorites , favorite != "" & Age!="")
favorites <- mutate(favorites , favorite = as.numeric(favorite))
favorites <- mutate(favorites , faveName = movies[favorites$favorite])
favorites$Age = gsub("> 60" , "60+" , favorites$Age)
favorites
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic()
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_color_brewer("Set1")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_color_brewer("Set2")
plot
?scale_color_brewer
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_color_brewer(palette = "Set2")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer(palette = "Set2")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer(palette = "Set1")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer(palette = "Set2")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer(palette = "Set2") +
ylab("Proportion")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
title("Everyone Like Episode V")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Like Episode V")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V")
plot
?labs
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
labs(size = 2)
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V")
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.text=element_text(size=12))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.text=element_text(size=12) ,
axis.title=element_text(size=14))
plot
?theme
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.text=element_text(size=12) ,
axis.title=element_text(size=14),
title=element_text(size=16))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.text=element_text(size=12) ,
axis.title=element_text(size=14),
title=element_text(size=16),
legend.text=element_text(size=12))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.title=element_text(size=14),
title=element_text(size=16))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.text=element_text(size=10) ,
axis.title=element_text(size=14),
title=element_text(size=16))
plot
plot <- ggplot(aes(x = Age) , data = favorites) +
geom_bar(aes(fill = faveName) , position = "fill") +
theme_classic() +
scale_fill_brewer("Favorite movie",palette = "Set2") +
ylab("Proportion") +
ggtitle("Everyone Likes Episode V") +
theme(axis.text=element_text(size=11) ,
axis.title=element_text(size=14),
title=element_text(size=16))
plot
